
@using StravaVisualizer.Models
@model ICollection<ActivityCoordinates>

<div id='myMap' style="position:relative;width:100%;height:400px;"></div>
<script type='text/javascript'>
    var map, clusterLayer;
    var locations = []
    var pins = []
    function loadMapScenario() {
        map = new Microsoft.Maps.Map(document.getElementById('myMap'), {});

        @foreach (ActivityCoordinates pin in Model) {
            @: var location = new Microsoft.Maps.Location(@pin.Start.Latitude, @pin.Start.Longitude)
            @: locations.push(location)
            @*@: var pin = new Microsoft.Maps.Pushpin(location, { text: "@pin.Text" });*@
            @: var pin = new Microsoft.Maps.Pushpin(location, { icon: pinSvg.join(''),  text: '1' });
            @: pins.push(pin)
            @*@: map.entities.push(pin);*@
        }

        var rect = Microsoft.Maps.LocationRect.fromLocations(locations)
        map.setView({ bounds: rect, padding: 0 })

        Microsoft.Maps.loadModule('Microsoft.Maps.Clustering', function () {
            var clusterLayer = new Microsoft.Maps.ClusterLayer(pins,
                {
                    clusteredPinCallback: createCustomClusteredPin,                    
                    gridSize: 80
                });
            map.layers.insert(clusterLayer);
        });       
    }
</script>
<script type='text/javascript' src='https://www.bing.com/api/maps/mapcontrol?key=AiazNxpO30PT7UwaV6w3yi9yxxYHIJ1CclFCdwHLt68WRhLpgGLMyij33FXz_psx&callback=loadMapScenario' async defer></script>

